<!-- ===================================================== -->
<!-- COMPOSANT CARTE INTERACTIVE - TEMPLATE HTML -->
<!-- ===================================================== -->

<div class="map-container" [attr.data-mode]="options.mode">
  <!-- Carte OpenLayers -->
  <div #mapElement [id]="mapId" class="map"></div>
  
  <!-- Contr√¥les de la carte -->
  <div class="map-controls" *ngIf="options.showLayers">
    <!-- Boutons d'outils -->
    <div class="tool-buttons" *ngIf="options.mode === 'create'">
      <button mat-icon-button 
              [class.active]="currentTool === 'polygon'"
              (click)="startDrawing('Polygon')"
              matTooltip="Dessiner une parcelle">
        <mat-icon>gesture</mat-icon>
      </button>
      
      <button mat-icon-button 
              [class.active]="currentTool === 'point'"
              (click)="startDrawing('Point')"
              matTooltip="Ajouter un point">
        <mat-icon>add_location</mat-icon>
      </button>
      
      <button mat-icon-button 
              (click)="clearDrawing()"
              matTooltip="Effacer le dessin">
        <mat-icon>clear</mat-icon>
      </button>
    </div>

    <!-- Panneau des couches -->
    <div class="layers-panel">
      <h4>Fonds de carte</h4>
      <select (change)="changeBasemap($any($event.target).value)" class="basemap-select">
        <option value="osm">OpenStreetMap</option>
        <option value="arcgis-topographic">ArcGIS Topographique</option>
        <option value="arcgis-imagery">ArcGIS Imagerie</option>
        <option value="arcgis-streets">ArcGIS Rues</option>
        <option value="arcgis-navigation">ArcGIS Navigation</option>
      </select>
      
      <h4>Couches ArcGIS</h4>
      <div class="layer-item">
        <mat-slide-toggle 
          [checked]="true"
          (change)="toggleArcGISLayer('communes', $event)">
          üèõÔ∏è Communes
        </mat-slide-toggle>
      </div>
      <div class="layer-item">
        <mat-slide-toggle 
          [checked]="true"
          (change)="toggleArcGISLayer('hotels', $event)">
          üè® H√¥tels
        </mat-slide-toggle>
      </div>
      <div class="layer-item">
        <mat-slide-toggle 
          [checked]="true"
          (change)="toggleArcGISLayer('grandes_surfaces', $event)">
          üè™ Grandes Surfaces
        </mat-slide-toggle>
      </div>
      <div class="layer-item">
        <mat-slide-toggle 
          [checked]="true"
          (change)="toggleArcGISLayer('voirie', $event)">
          üõ£Ô∏è Voirie
        </mat-slide-toggle>
      </div>
      
      <!-- Les couches locales GeoJSON ont √©t√© remplac√©es par les couches ArcGIS -->
    </div>
  </div>

  <!-- Panneau d'informations de la parcelle s√©lectionn√©e -->
  <div class="parcelle-info" *ngIf="selectedParcelle && options.mode !== 'create'">
    <div class="info-header">
      <h3>{{ selectedParcelle.referenceFonciere }}</h3>
      <button mat-icon-button (click)="selectedParcelle = null">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="info-content">
      <div class="info-item">
        <strong>Surface totale:</strong> {{ selectedParcelle.surfaceTotale }} m¬≤
      </div>
      <div class="info-item">
        <strong>Surface imposable:</strong> {{ selectedParcelle.surfaceImposable }} m¬≤
      </div>
      <div class="info-item">
        <strong>Statut:</strong> 
        <span [ngClass]="getStatusClass(selectedParcelle.etatValidation)">
          {{ getStatusLabel(selectedParcelle.etatValidation) }}
        </span>
      </div>
      <div class="info-item">
        <strong>TNB:</strong> {{ selectedParcelle.montantTotalTnb }} MAD
      </div>
    </div>
  </div>

  <!-- Indicateur de chargement -->
  <div class="loading-indicator" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
    <span>Chargement des donn√©es...</span>
  </div>
</div>
