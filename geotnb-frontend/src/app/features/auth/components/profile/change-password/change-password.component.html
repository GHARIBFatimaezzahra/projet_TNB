<div class="change-password-container">
    <div class="change-password-wrapper">
      <!-- En-tête -->
      <div class="page-header">
        <button mat-icon-button (click)="cancel()" class="back-button">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <h1>Changer le mot de passe</h1>
      </div>
  
      <!-- Formulaire principal -->
      <mat-card class="change-password-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>lock</mat-icon>
            Modification du mot de passe
          </mat-card-title>
          <mat-card-subtitle>
            Choisissez un nouveau mot de passe sécurisé
          </mat-card-subtitle>
        </mat-card-header>
  
        <mat-card-content>
          <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="change-password-form" novalidate>
            
            <!-- Mot de passe actuel -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Mot de passe actuel</mat-label>
              <input 
                matInput 
                [type]="hideCurrentPassword ? 'password' : 'text'"
                formControlName="currentPassword"
                autocomplete="current-password"
                placeholder="Saisissez votre mot de passe actuel">
              <mat-icon 
                matSuffix 
                (click)="toggleCurrentPasswordVisibility()" 
                class="password-toggle">
                {{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}
              </mat-icon>
              <mat-error *ngIf="currentPassword?.hasError('required')">
                Le mot de passe actuel est requis
              </mat-error>
            </mat-form-field>
  
            <!-- Nouveau mot de passe -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nouveau mot de passe</mat-label>
              <input 
                matInput 
                [type]="hideNewPassword ? 'password' : 'text'"
                formControlName="newPassword"
                autocomplete="new-password"
                placeholder="Saisissez votre nouveau mot de passe">
              <mat-icon 
                matSuffix 
                (click)="toggleNewPasswordVisibility()" 
                class="password-toggle">
                {{ hideNewPassword ? 'visibility_off' : 'visibility' }}
              </mat-icon>
              <mat-error *ngIf="newPassword?.hasError('required')">
                Le nouveau mot de passe est requis
              </mat-error>
              <mat-error *ngIf="newPassword?.hasError('minlength')">
                Minimum 8 caractères requis
              </mat-error>
              <mat-error *ngIf="newPassword?.hasError('passwordStrength')">
                Le mot de passe ne respecte pas les critères de sécurité
              </mat-error>
            </mat-form-field>
  
            <!-- Indicateur de force du mot de passe -->
            <div class="password-strength" *ngIf="newPassword?.value">
              <div class="strength-bar">
                <div [class]="'strength-indicator ' + getPasswordStrengthClass()"></div>
              </div>
              <span class="strength-label">{{ getPasswordStrengthLabel() }}</span>
            </div>
  
            <!-- Confirmation nouveau mot de passe -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirmer le nouveau mot de passe</mat-label>
              <input 
                matInput 
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword"
                autocomplete="new-password"
                placeholder="Confirmez votre nouveau mot de passe">
              <mat-icon 
                matSuffix 
                (click)="toggleConfirmPasswordVisibility()" 
                class="password-toggle">
                {{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}
              </mat-icon>
              <mat-error *ngIf="confirmPassword?.hasError('required')">
                La confirmation est requise
              </mat-error>
              <mat-error *ngIf="changePasswordForm?.hasError('passwordMismatch') && confirmPassword?.touched">
                Les mots de passe ne correspondent pas
              </mat-error>
            </mat-form-field>
  
          </form>
        </mat-card-content>
  
        <mat-card-actions align="end">
          <button mat-button (click)="cancel()" [disabled]="isLoading">
            <mat-icon>cancel</mat-icon>
            Annuler
          </button>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="onSubmit()"
            [disabled]="changePasswordForm.invalid || isLoading">
            <mat-icon *ngIf="!isLoading">save</mat-icon>
            <mat-icon *ngIf="isLoading" class="spinning">hourglass_empty</mat-icon>
            <span *ngIf="!isLoading">Changer le mot de passe</span>
            <span *ngIf="isLoading">Modification...</span>
          </button>
        </mat-card-actions>
  
        <!-- Barre de progression -->
        <mat-progress-bar 
          *ngIf="isLoading" 
          mode="indeterminate" 
          class="progress-bar">
        </mat-progress-bar>
      </mat-card>
  
      <!-- Carte critères de sécurité -->
      <mat-card class="security-criteria-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>security</mat-icon>
            Critères de sécurité
          </mat-card-title>
          <mat-card-subtitle>
            Votre mot de passe doit respecter tous ces critères
          </mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <mat-list class="criteria-list">
            <mat-list-item class="criteria-item">
              <mat-icon 
                matListItemIcon 
                [class]="passwordCriteria.minLength ? 'valid' : 'invalid'">
                {{ passwordCriteria.minLength ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
              <div matListItemTitle>Au moins 8 caractères</div>
            </mat-list-item>
  
            <mat-list-item class="criteria-item">
              <mat-icon 
                matListItemIcon 
                [class]="passwordCriteria.hasUpperCase ? 'valid' : 'invalid'">
                {{ passwordCriteria.hasUpperCase ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
              <div matListItemTitle>Au moins une majuscule (A-Z)</div>
            </mat-list-item>
  
            <mat-list-item class="criteria-item">
              <mat-icon 
                matListItemIcon 
                [class]="passwordCriteria.hasLowerCase ? 'valid' : 'invalid'">
                {{ passwordCriteria.hasLowerCase ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
              <div matListItemTitle>Au moins une minuscule (a-z)</div>
            </mat-list-item>
  
            <mat-list-item class="criteria-item">
              <mat-icon 
                matListItemIcon 
                [class]="passwordCriteria.hasNumber ? 'valid' : 'invalid'">
                {{ passwordCriteria.hasNumber ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
              <div matListItemTitle>Au moins un chiffre (0-9)</div>
            </mat-list-item>
  
            <mat-list-item class="criteria-item">
              <mat-icon 
                matListItemIcon 
                [class]="passwordCriteria.hasSpecial ? 'valid' : 'invalid'">
                {{ passwordCriteria.hasSpecial ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
              <div matListItemTitle>Au moins un caractère spécial (!@#$%^&*)</div>
            </mat-list-item>
          </mat-list>
        </mat-card-content>
      </mat-card>
  
      <!-- Conseils de sécurité -->
      <mat-card class="security-tips-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>tips_and_updates</mat-icon>
            Conseils de sécurité
          </mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <ul class="tips-list">
            <li>Utilisez un mot de passe unique pour ce compte</li>
            <li>Évitez les informations personnelles (nom, date de naissance)</li>
            <li>Mélangez lettres, chiffres et symboles</li>
            <li>Changez votre mot de passe régulièrement</li>
            <li>Ne partagez jamais votre mot de passe</li>
          </ul>
        </mat-card-content>
      </mat-card>
    </div>
  </div>