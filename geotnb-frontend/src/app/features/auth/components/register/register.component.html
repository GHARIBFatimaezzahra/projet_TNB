<div class="conteneur-connexion">
  <div class="carte-connexion-wrapper">
    <div class="carte-connexion">
      <!-- En-tÃªte -->
      <div class="en-tete-connexion">
        <div class="conteneur-logo">
          <mat-icon class="icone-geo">person_add</mat-icon>
        </div>
        <h1 class="titre-application">CrÃ©er un compte</h1>
        <p class="sous-titre-application">GÃ©oportail TNB - Commune d'Oujda</p>
      </div>

      <!-- Contenu principal -->
      <div class="contenu-connexion">
        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="formulaire-connexion" novalidate>
          
          <!-- Type d'utilisateur -->
          <div class="groupe-champ">
            <label class="etiquette-champ">Type d'utilisateur</label>
            <select formControlName="profil" class="champ-saisie" (change)="onUserTypeChange($any($event.target).value)">
              <option value="" disabled>SÃ©lectionnez votre profil</option>
              <option *ngFor="let role of userRoles" [value]="role.value">
                {{ role.label }} - {{ role.description }}
              </option>
            </select>
            <div class="message-erreur" *ngIf="profil?.invalid && profil?.touched">
              <span>Veuillez sÃ©lectionner un type d'utilisateur</span>
            </div>
          </div>

          <!-- Nom d'utilisateur -->
          <div class="groupe-champ">
            <label class="etiquette-champ">Nom d'utilisateur</label>
            <input 
              type="text"
              formControlName="username" 
              class="champ-saisie"
              autocomplete="username"
              placeholder="Saisissez un nom d'utilisateur unique">
            <div class="message-erreur" *ngIf="username?.invalid && username?.touched">
              <span *ngIf="username?.hasError('required')">Le nom d'utilisateur est requis</span>
              <span *ngIf="username?.hasError('minlength')">Minimum 3 caractÃ¨res requis</span>
            </div>
          </div>

          <!-- Email -->
          <div class="groupe-champ">
            <label class="etiquette-champ">Adresse email</label>
            <input 
              type="email"
              formControlName="email" 
              class="champ-saisie"
              autocomplete="email"
              placeholder="nom@commune-oujda.ma">
            <div class="message-erreur" *ngIf="email?.invalid && email?.touched">
              <span *ngIf="email?.hasError('required')">L'adresse email est requise</span>
              <span *ngIf="email?.hasError('email')">Format d'email invalide</span>
            </div>
          </div>

          <!-- Mot de passe -->
          <div class="groupe-champ">
            <label class="etiquette-champ">Mot de passe</label>
            <div class="conteneur-mot-de-passe">
              <input 
                [type]="hidePassword ? 'password' : 'text'"
                formControlName="password"
                class="champ-saisie"
                autocomplete="new-password"
                placeholder="CrÃ©ez un mot de passe sÃ©curisÃ©">
              <button 
                type="button"
                class="bouton-visibilite" 
                (click)="togglePasswordVisibility()">
                {{ hidePassword ? 'ğŸ‘ï¸' : 'ğŸ”’' }}
              </button>
            </div>
            <div class="message-erreur" *ngIf="password?.invalid && password?.touched">
              <span *ngIf="password?.hasError('required')">Le mot de passe est requis</span>
              <span *ngIf="password?.hasError('minlength')">Minimum 8 caractÃ¨res requis</span>
            </div>
          </div>

          <!-- Confirmation mot de passe -->
          <div class="groupe-champ">
            <label class="etiquette-champ">Confirmer le mot de passe</label>
            <div class="conteneur-mot-de-passe">
              <input 
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword"
                class="champ-saisie"
                autocomplete="new-password"
                placeholder="RÃ©pÃ©tez le mot de passe">
              <button 
                type="button"
                class="bouton-visibilite" 
                (click)="toggleConfirmPasswordVisibility()">
                {{ hideConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ”’' }}
              </button>
            </div>
            <div class="message-erreur" *ngIf="confirmPassword?.invalid && confirmPassword?.touched">
              <span *ngIf="confirmPassword?.hasError('required')">La confirmation est requise</span>
            </div>
            <div class="message-erreur" *ngIf="registerForm?.hasError('passwordMismatch') && confirmPassword?.touched">
              <span>Les mots de passe ne correspondent pas</span>
            </div>
          </div>

          <!-- Bouton de crÃ©ation -->
          <button 
            type="submit"
            class="bouton-connexion"
            [disabled]="registerForm.invalid || isLoading">
            <span class="indicateur-chargement" *ngIf="isLoading"></span>
            <span class="texte-bouton">
              {{ isLoading ? 'CrÃ©ation en cours...' : 'CrÃ©er le compte' }}
            </span>
          </button>
        </form>

        <!-- Actions secondaires -->
        <div class="actions-secondaires">
          <div class="separateur-ou">
            <span>ou</span>
          </div>
          
          <a routerLink="/auth/login" class="lien-mot-de-passe-oublie">
            <mat-icon class="icone-lien">login</mat-icon>
            DÃ©jÃ  un compte ? Se connecter
          </a>
        </div>
      </div>

      <!-- Informations systÃ¨me -->
      <div class="informations-systeme">
        <p class="texte-info">Nouveau compte utilisateur - SystÃ¨me TNB</p>
        <p class="numero-version">Version 1.0.0</p>
      </div>
    </div>
  </div>
</div>