<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <h2>GeoTNB</h2>
      <p>Commune d'Oujda</p>
    </div>
    <ul class="nav-menu">
      <li class="nav-item">
        <a href="#" class="nav-link active">
          <span class="nav-icon">ğŸ“Š</span>
          Dashboard
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link">
          <span class="nav-icon">ğŸ—ºï¸</span>
          Cartographie
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link">
          <span class="nav-icon">ğŸ˜ï¸</span>
          Parcelles
        </a>
      </li>
      <li class="nav-item">
        <a href="/spatial-queries" class="nav-link">
          <span class="nav-icon">ğŸ”</span>
          Recherche AvancÃ©e
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link">
          <span class="nav-icon">ğŸ‘¥</span>
          PropriÃ©taires
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link">
          <span class="nav-icon">ğŸ“‹</span>
          Fiches TNB
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link">
          <span class="nav-icon">âš™ï¸</span>
          ParamÃ¨tres
        </a>
      </li>
    </ul>
  </aside>

  <!-- Contenu principal -->
  <main class="main-content">
    <!-- En-tÃªte -->
    <header class="header">
      <h1>Tableau de Bord TNB</h1>
      <p>Vue d'ensemble des terrains non bÃ¢tis - Mise Ã  jour en temps rÃ©el</p>
    </header>

    <!-- Filtres -->
    <section class="filters-section">
      <h3 style="margin-bottom: 20px; color: #333;">ğŸ” Filtres et SÃ©lections</h3>
      <div class="filters-grid">
        <div class="control-group">
          <label class="control-label">Secteur</label>
          <select class="control-input" [(ngModel)]="selectedSecteur">
            <option value="">Tous les secteurs</option>
            <option value="centre">Centre-ville</option>
            <option value="hay-al-qods">Hay Al Qods</option>
            <option value="sidi-maafa">Sidi MaÃ¢fa</option>
            <option value="al-andalous">Al Andalous</option>
          </select>
        </div>
        <div class="control-group">
          <label class="control-label">Zonage</label>
          <select class="control-input" [(ngModel)]="selectedZonage">
            <option value="">Tous les zonages</option>
            <option value="r+2">Zone R+2</option>
            <option value="r+4">Zone R+4</option>
            <option value="industriel">Zone Industrielle</option>
            <option value="villas">Zone Villas</option>
          </select>
        </div>
        <div class="control-group">
          <label class="control-label">Statut Foncier</label>
          <select class="control-input" [(ngModel)]="selectedStatut">
            <option value="">Tous les statuts</option>
            <option value="tf">Titre Foncier (TF)</option>
            <option value="r">RÃ©quisition (R)</option>
            <option value="ni">Non ImmatriculÃ© (NI)</option>
          </select>
        </div>
        <div class="control-group">
          <label class="control-label">Ã‰tat d'occupation</label>
          <select class="control-input" [(ngModel)]="selectedOccupation">
            <option value="">Tous les Ã©tats</option>
            <option value="nu">Terrain nu</option>
            <option value="partiel">Partiellement construit</option>
            <option value="construction">En cours de construction</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Indicateurs clÃ©s -->
    <section class="stats-grid">
      <div class="stat-card pulse">
        <div class="stat-value animate-number">{{ kpiData?.terrainsRecenses | number }}</div>
        <div class="stat-label">Terrains recensÃ©s</div>
        <div class="stat-trend">â†—ï¸ +5.2% ce mois</div>
      </div>
      <div class="stat-card">
        <div class="stat-value animate-number">{{ kpiData?.terrainsImposables | number }}</div>
        <div class="stat-label">Terrains imposables</div>
        <div class="stat-trend">ğŸ“ˆ {{ tauxImposition | percent:'1.1-1' }} du total</div>
      </div>
      <div class="stat-card">
        <div class="stat-value animate-number">{{ kpiData?.superficieTotale | number:'1.0-0' }} ha</div>
        <div class="stat-label">Superficie totale</div>
        <div class="stat-trend">ğŸ˜ï¸ PÃ©rimÃ¨tre urbain</div>
      </div>
      <div class="stat-card">
        <div class="stat-value animate-number">{{ kpiData?.surfaceImposable | number:'1.0-0' }} ha</div>
        <div class="stat-label">Surface imposable</div>
        <div class="stat-trend">ğŸ’° {{ tauxSurfaceImposable | percent:'1.1-1' }} taxable</div>
      </div>
      <div class="stat-card">
        <div class="stat-value animate-number">{{ kpiData?.rendementPrevisionnel | number:'1.1-1' }} MDH</div>
        <div class="stat-label">Rendement prÃ©visionnel</div>
        <div class="stat-trend">ğŸ’¸ Recette annuelle</div>
      </div>
      <div class="stat-card">
        <div class="stat-value animate-number">{{ kpiData?.tauxAssujettissement | percent:'1.1-1' }}</div>
        <div class="stat-label">Taux d'assujettissement</div>
        <div class="stat-trend">âš–ï¸ Base imposable</div>
      </div>
    </section>

    <!-- Graphiques -->
    <section class="charts-grid">
      <div class="chart-card">
        <div class="chart-title">
          <span>ğŸ“Š RÃ©partition par Statut Foncier</span>
          <button class="btn btn-secondary" (click)="exportChart('statut')">Export</button>
        </div>
        <div class="chart-container">
          <canvas id="statutChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">
          <span>ğŸ“ˆ Ã‰volution Mensuelle des Recettes</span>
          <button class="btn btn-secondary" (click)="exportChart('recettes')">Export</button>
        </div>
        <div class="chart-container">
          <canvas id="recettesChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">
          <span>ğŸ˜ï¸ RÃ©partition par Zonage Urbanistique</span>
          <button class="btn btn-secondary" (click)="exportChart('zonage')">Export</button>
        </div>
        <div class="chart-container">
          <canvas id="zonageChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">
          <span>ğŸ’° Tranches Tarifaires</span>
          <button class="btn btn-secondary" (click)="exportChart('tarifs')">Export</button>
        </div>
        <div class="chart-container">
          <canvas id="tarifsChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Section cartographique -->
    <section class="map-section">
      <div class="map-container">
        <div class="chart-title">
          <span>ğŸ—ºï¸ Carte ThÃ©matique Interactive</span>
          <select class="control-input" style="width: auto;" [(ngModel)]="selectedMapTheme" (change)="onMapThemeChange()">
            <option value="density">DensitÃ© TNB par secteur</option>
            <option value="tarif">Classification tarifaire</option>
            <option value="statut">Statut foncier</option>
            <option value="occupation">Ã‰tat d'occupation</option>
            <option value="zonage">Zonage urbanistique</option>
            <option value="rendement">Rendement fiscal</option>
          </select>
        </div>
        <div class="map-placeholder">
          <div style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ—ºï¸</div>
            <div>Carte ThÃ©matique Interactive</div>
            <div style="font-size: 12px; color: #999; margin-top: 5px;">
              IntÃ©gration OpenLayers avec couches PostGIS
            </div>
          </div>
        </div>
      </div>
      <div class="map-controls">
        <h4 style="margin-bottom: 15px; color: #333;">ğŸ¨ LÃ©gende</h4>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff4757;"></div>
          <span>Tarif Ã©levÃ© (>15 DH/mÂ²)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff9ff3;"></div>
          <span>Tarif moyen (8-15 DH/mÂ²)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #54a0ff;"></div>
          <span>Tarif faible (2-8 DH/mÂ²)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #5f27cd;"></div>
          <span>ExonÃ©rÃ© temporairement</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #10ac84;"></div>
          <span>Non imposable</span>
        </div>
        
        <div style="margin-top: 20px;">
          <h4 style="margin-bottom: 15px; color: #333;">ğŸ“‹ Couches Disponibles</h4>
          <label style="display: block; margin-bottom: 8px;">
            <input type="checkbox" [(ngModel)]="layers.parcelles" checked> Parcelles TNB
          </label>
          <label style="display: block; margin-bottom: 8px;">
            <input type="checkbox" [(ngModel)]="layers.limites" checked> Limites administratives
          </label>
          <label style="display: block; margin-bottom: 8px;">
            <input type="checkbox" [(ngModel)]="layers.plans"> Plans d'amÃ©nagement
          </label>
          <label style="display: block; margin-bottom: 8px;">
            <input type="checkbox" [(ngModel)]="layers.orthophotos"> Orthophotos
          </label>
        </div>
      </div>
    </section>

    <!-- Section d'export -->
    <section class="export-section">
      <h3 style="margin-bottom: 20px; color: #333;">ğŸ“¤ Exports et Rapports</h3>
      <div class="export-buttons">
        <button class="btn btn-primary" (click)="exportReport('pdf')">
          ğŸ“Š Rapport PDF Complet
        </button>
        <button class="btn btn-primary" (click)="exportReport('excel')">
          ğŸ“ˆ Graphiques Excel
        </button>
        <button class="btn btn-secondary" (click)="exportReport('cartes')">
          ğŸ—ºï¸ Cartes ThÃ©matiques
        </button>
        <button class="btn btn-secondary" (click)="exportReport('donnees')">
          ğŸ“‹ DonnÃ©es Tabulaires
        </button>
        <button class="btn btn-secondary" (click)="exportReport('secteurs')">
          ğŸ˜ï¸ Fiches par Secteur
        </button>
      </div>
    </section>
  </main>
</div>