<div class="parcelle-form">
    <div class="page-header">
      <h1>{{ isEditMode ? 'Modifier' : 'Créer' }} une Parcelle</h1>
      <p>{{ isEditMode ? 'Modifier les informations' : 'Saisir les informations' }} de la parcelle</p>
    </div>
  
    <form [formGroup]="parcelleForm" (ngSubmit)="onSubmit()" class="form-container">
      <div class="form-sections">
        <!-- Section Identification -->
        <div class="form-section">
          <h3>Identification de la parcelle</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="referenceFonciere">Référence Foncière *</label>
              <input 
                type="text" 
                id="referenceFonciere" 
                formControlName="referenceFonciere" 
                class="form-control"
                [class.error]="parcelleForm.get('referenceFonciere')?.invalid && parcelleForm.get('referenceFonciere')?.touched">
              <div class="error-message" 
                   *ngIf="parcelleForm.get('referenceFonciere')?.invalid && parcelleForm.get('referenceFonciere')?.touched">
                La référence foncière est requise
              </div>
            </div>
  
            <div class="form-group">
              <label for="statutFoncier">Statut Foncier *</label>
              <select 
                id="statutFoncier" 
                formControlName="statutFoncier" 
                class="form-control"
                [class.error]="parcelleForm.get('statutFoncier')?.invalid && parcelleForm.get('statutFoncier')?.touched">
                <option value="">Sélectionner un statut</option>
                <option *ngFor="let statut of statutsFonciers" [value]="statut.value">
                  {{ statut.label }}
                </option>
              </select>
            </div>
          </div>
  
          <div class="form-row">
            <div class="form-group">
              <label for="statutOccupation">Statut d'Occupation *</label>
              <select 
                id="statutOccupation" 
                formControlName="statutOccupation" 
                class="form-control">
                <option value="">Sélectionner un statut</option>
                <option *ngFor="let statut of statutsOccupation" [value]="statut.value">
                  {{ statut.label }}
                </option>
              </select>
            </div>
  
            <div class="form-group">
              <label for="zonage">Zonage *</label>
              <select 
                id="zonage" 
                formControlName="zonage" 
                class="form-control">
                <option value="">Sélectionner un zonage</option>
                <option *ngFor="let zone of zonages" [value]="zone.value">
                  {{ zone.label }}
                </option>
              </select>
            </div>
          </div>
        </div>
  
        <!-- Section Surface -->
        <div class="form-section">
          <h3>Informations sur la surface</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="surfaceTotale">Surface Totale (m²) *</label>
              <input 
                type="number" 
                id="surfaceTotale" 
                formControlName="surfaceTotale" 
                class="form-control"
                min="0"
                step="0.01">
            </div>
  
            <div class="form-group">
              <label for="surfaceImposable">Surface Imposable (m²) *</label>
              <input 
                type="number" 
                id="surfaceImposable" 
                formControlName="surfaceImposable" 
                class="form-control"
                min="0"
                step="0.01">
            </div>
          </div>
        </div>
  
        <!-- Section Fiscale -->
                <div class="form-section">
          <h3>Informations fiscales</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="categorieFiscale">Catégorie Fiscale</label>
              <input 
                type="text" 
                id="categorieFiscale" 
                formControlName="categorieFiscale" 
                class="form-control">
            </div>
  
            <div class="form-group">
              <label for="prixUnitaireM2">Prix Unitaire (DH/m²) *</label>
              <input 
                type="number" 
                id="prixUnitaireM2" 
                formControlName="prixUnitaireM2" 
                class="form-control"
                min="0"
                step="0.01">
            </div>
          </div>
  
          <div class="form-row">
            <div class="form-group">
              <div class="checkbox-group">
                <input 
                  type="checkbox" 
                  id="exonereTNB" 
                  formControlName="exonereTNB">
                <label for="exonereTNB">Exonéré de la TNB</label>
              </div>
            </div>
          </div>
  
          <!-- Section Exonération (conditionnelle) -->
          <div *ngIf="parcelleForm.get('exonereTNB')?.value" class="exoneration-section">
            <div class="form-row">
              <div class="form-group">
                <label for="datePermis">Date du Permis</label>
                <input 
                  type="date" 
                  id="datePermis" 
                  formControlName="datePermis" 
                  class="form-control">
              </div>
  
              <div class="form-group">
                <label for="dureeExoneration">Durée d'Exonération (années)</label>
                <input 
                  type="number" 
                  id="dureeExoneration" 
                  formControlName="dureeExoneration" 
                  class="form-control"
                  min="0"
                  max="10">
              </div>
            </div>
          </div>
  
          <!-- Calcul automatique du montant -->
          <div class="calculation-display" *ngIf="!parcelleForm.get('exonereTNB')?.value">
            <h4>Montant TNB Calculé</h4>
            <div class="amount-display">
              {{ calculateMontantTNB() | currency:'MAD':'symbol':'1.0-2' }}
            </div>
          </div>
        </div>
      </div>
  
      <!-- Erreur -->
      <div class="error-message" *ngIf="error">
        {{ error }}
      </div>
  
      <!-- Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-outline" (click)="onCancel()">
          Annuler
        </button>
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="loading || parcelleForm.invalid">
          <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
          {{ loading ? 'Sauvegarde...' : (isEditMode ? 'Modifier' : 'Créer') }}
        </button>
      </div>
    </form>
  </div>