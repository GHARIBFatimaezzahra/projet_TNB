<!-- Interface 2 - Formulaire de Cr√©ation de Parcelle - Design exact fourni -->
<div class="container">
  <div class="interface-section">
    <div class="section-header">
      <mat-icon>add_circle</mat-icon>
      2. Formulaire de Cr√©ation de Parcelle
    </div>
    <div class="section-content">
      <div class="form-container">
        <div class="form-header">
          <h2>Nouvelle Parcelle</h2>
          <p>Remplissez les informations de la nouvelle parcelle</p>
        </div>
  
        <div class="form-tabs">
          <div class="form-tab" 
               [class.active]="activeTab === 'general'"
               (click)="switchTab('general')">
            <mat-icon>description</mat-icon>
            üìã G√©n√©ral
          </div>
          <div class="form-tab" 
               [class.active]="activeTab === 'fiscal'"
               (click)="switchTab('fiscal')">
            <mat-icon>attach_money</mat-icon>
            üí∞ Fiscal
          </div>
          <div class="form-tab" 
               [class.active]="activeTab === 'geometry'"
               (click)="switchTab('geometry')">
            <mat-icon>straighten</mat-icon>
            üìê G√©om√©trie
          </div>
          <div class="form-tab" 
               [class.active]="activeTab === 'documents'"
               (click)="switchTab('documents')">
            <mat-icon>folder</mat-icon>
            üìÑ Documents
          </div>
          <div class="form-tab" 
               [class.active]="activeTab === 'proprietaires'"
               (click)="switchTab('proprietaires')">
            <mat-icon>group</mat-icon>
            üë• Propri√©taires
          </div>
        </div>
        
        <div class="tab-content">
          <!-- Onglet G√©n√©ral -->
          <div class="tab-pane" [class.active]="activeTab === 'general'">
            <h3>Informations g√©n√©rales</h3>
            
            <form [formGroup]="parcelleForm" class="form-layout">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required">R√©f√©rence fonci√®re *</label>
                  <mat-form-field appearance="outline">
                    <input matInput formControlName="reference" placeholder="TF-123456-A">
                    <mat-error *ngIf="parcelleForm.get('reference')?.errors?.['required']">
                      La r√©f√©rence est obligatoire
                    </mat-error>
                    <mat-error *ngIf="parcelleForm.get('reference')?.errors?.['pattern']">
                      Format: TF/R/NI-XXXXXX-X
                    </mat-error>
                  </mat-form-field>
                  <small class="form-help">Format: TF/R/NI-XXXXXX-X</small>
        </div>
  
                <div class="form-group">
                  <label class="form-label required">Statut foncier *</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="statut_foncier">
                      <mat-option value="">S√©lectionner un statut</mat-option>
                      <mat-option value="TF">TF - Titre Foncier</mat-option>
                      <mat-option value="R">R - R√©quisition</mat-option>
                      <mat-option value="NI">NI - Non Immatricul√©</mat-option>
                      <mat-option value="Domanial">Domanial</mat-option>
                      <mat-option value="Collectif">Collectif</mat-option>
                    </mat-select>
                    <mat-error *ngIf="parcelleForm.get('statut_foncier')?.errors?.['required']">
                      Le statut foncier est obligatoire
                    </mat-error>
                  </mat-form-field>
                </div>
        </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required">Surface totale (m¬≤) *</label>
                  <mat-form-field appearance="outline">
                    <input matInput type="number" formControlName="surface_totale" 
                           placeholder="0" step="0.01" min="0">
                    <mat-error *ngIf="parcelleForm.get('surface_totale')?.errors?.['required']">
                      La surface totale est obligatoire
                    </mat-error>
                    <mat-error *ngIf="parcelleForm.get('surface_totale')?.errors?.['min']">
                      La surface doit √™tre positive
                    </mat-error>
                  </mat-form-field>
                </div>
                
                <div class="form-group">
                  <label class="form-label required">Zone urbanistique *</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="zone">
                      <mat-option value="">S√©lectionner une zone</mat-option>
                      <mat-option value="R+4">R+4 - R√©sidentiel 4 √©tages</mat-option>
                      <mat-option value="R+2">R+2 - R√©sidentiel 2 √©tages</mat-option>
                      <mat-option value="COM">COM - Commercial</mat-option>
                      <mat-option value="IND">IND - Industriel</mat-option>
                      <mat-option value="EQ">EQ - √âquipements</mat-option>
                    </mat-select>
                    <mat-error *ngIf="parcelleForm.get('zone')?.errors?.['required']">
                      La zone urbanistique est obligatoire
                    </mat-error>
                  </mat-form-field>
                </div>
        </div>
  
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Statut occupation</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="statut_occupation">
                      <mat-option value="Nu" selected>Nu</mat-option>
                      <mat-option value="Construit">Construit</mat-option>
                      <mat-option value="En_Construction">En construction</mat-option>
                      <mat-option value="Partiellement_Construit">Partiellement construit</mat-option>
                    </mat-select>
                  </mat-form-field>
        </div>
                
                <div class="form-group">
                  <label class="form-label">Adresse/Localisation</label>
                  <mat-form-field appearance="outline">
                    <input matInput formControlName="adresse" placeholder="Quartier, rue...">
                  </mat-form-field>
                </div>
        </div>
  
              <div class="form-group">
                <label class="form-label">Observations</label>
                <mat-form-field appearance="outline">
                  <textarea matInput formControlName="observations" 
                            rows="3" placeholder="Remarques particuli√®res sur cette parcelle..."></textarea>
                </mat-form-field>
              </div>
            </form>
        </div>
          
          <!-- Onglet Fiscal -->
          <div class="tab-pane" [class.active]="activeTab === 'fiscal'">
            <h3>Donn√©es fiscales TNB</h3>
            
            <form [formGroup]="fiscalForm" class="form-layout">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required">Surface imposable (m¬≤) *</label>
                  <mat-form-field appearance="outline">
                    <input matInput type="number" formControlName="surface_imposable" 
                           placeholder="0" step="0.01" min="0" (input)="calculateTNB()">
                    <mat-error *ngIf="fiscalForm.get('surface_imposable')?.errors?.['required']">
                      La surface imposable est obligatoire
                    </mat-error>
                  </mat-form-field>
                </div>
                
                <div class="form-group">
                  <label class="form-label required">Prix unitaire (DH/m¬≤) *</label>
                  <mat-form-field appearance="outline">
                    <input matInput type="number" formControlName="prix_unitaire" 
                           placeholder="0" step="0.01" min="0" (input)="calculateTNB()">
                    <mat-error *ngIf="fiscalForm.get('prix_unitaire')?.errors?.['required']">
                      Le prix unitaire est obligatoire
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Coefficient d'abattement</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="coefficient_abattement" (selectionChange)="calculateTNB()">
                      <mat-option value="1">Aucun (100%)</mat-option>
                      <mat-option value="0.8">20% (terrain en pente)</mat-option>
                      <mat-option value="0.7">30% (difficult√©s d'acc√®s)</mat-option>
                      <mat-option value="0.5">50% (contraintes majeures)</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Ann√©e fiscale</label>
                  <mat-form-field appearance="outline">
                    <input matInput type="number" formControlName="annee_fiscale" 
                           [value]="currentYear" min="2020" max="2030">
                  </mat-form-field>
                </div>
              </div>
  
              <!-- Exon√©ration -->
              <div class="form-group">
                <mat-checkbox formControlName="exonere_tnb" (change)="calculateTNB()">
                  Parcelle exon√©r√©e de la TNB (permis r√©cent)
                </mat-checkbox>
              </div>
              
              <div *ngIf="fiscalForm.get('exonere_tnb')?.value" class="exoneration-details">
                <div class="alert alert-warning">
                  <mat-icon>info</mat-icon>
                  L'exon√©ration TNB s'applique selon la loi 47-06 pour les terrains avec permis r√©cent.
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label required">Date du permis</label>
                    <mat-form-field appearance="outline">
                      <input matInput type="date" formControlName="date_permis">
                    </mat-form-field>
                    <small class="form-help">Date de d√©livrance du permis de construire/lotir</small>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label required">Dur√©e d'exon√©ration</label>
                    <mat-form-field appearance="outline">
                      <mat-select formControlName="duree_exoneration">
                        <mat-option value="">S√©lectionner...</mat-option>
                        <mat-option value="3">3 ans (surface ‚â§ 500 m¬≤)</mat-option>
                        <mat-option value="5">5 ans (500 < surface ‚â§ 1000 m¬≤)</mat-option>
                        <mat-option value="7">7 ans (surface > 1000 m¬≤)</mat-option>
                      </mat-select>
                    </mat-form-field>
                </div>
                </div>
              </div>
  
              <!-- Calcul TNB -->
              <div class="tnb-calculation-card">
                <div class="card-header">
                  <h4>Calcul TNB automatique</h4>
                  <button type="button" mat-stroked-button (click)="recalculateTNB()">
                    <mat-icon>refresh</mat-icon>
                    Recalculer
                  </button>
                </div>
                <div class="calculation-result">
                  <div class="calculation-formula">
                    <p>Formule: Surface imposable √ó Prix unitaire √ó Coefficient</p>
                  </div>
                  <div class="calculation-detail">
                    <span>{{ fiscalForm.get('surface_imposable')?.value || 0 }} m¬≤</span>
                    <span>√ó</span>
                    <span>{{ fiscalForm.get('prix_unitaire')?.value || 0 }} DH/m¬≤</span>
                    <span>√ó</span>
                    <span>{{ fiscalForm.get('coefficient_abattement')?.value || 1 }}</span>
                    <span>=</span>
                  </div>
                  <div class="calculation-total">
                    <strong>{{ formatCurrency(calculatedTNB) }}</strong>
                  </div>
                  <div *ngIf="fiscalForm.get('exonere_tnb')?.value" class="exoneration-notice">
                    <mat-icon>info</mat-icon>
                    Montant exon√©r√© jusqu'au {{ getExonerationEndDate() }}
                  </div>
                </div>
              </div>
            </form>
          </div>
          
          <!-- Autres onglets (placeholder pour l'instant) -->
          <div class="tab-pane" [class.active]="activeTab === 'geometry'">
            <h3>G√©om√©trie et localisation</h3>
            <div class="placeholder-content">
              <mat-icon>map</mat-icon>
              <p>Interface de dessin g√©om√©trique (OpenLayers)</p>
              <p>√Ä impl√©menter dans l'Interface 4</p>
            </div>
          </div>
          
          <div class="tab-pane" [class.active]="activeTab === 'documents'">
            <h3>Documents joints</h3>
            <div class="placeholder-content">
              <mat-icon>folder</mat-icon>
              <p>Gestionnaire de documents</p>
              <p>Upload, visualisation, organisation</p>
            </div>
          </div>
          
          <div class="tab-pane" [class.active]="activeTab === 'proprietaires'">
            <h3>Propri√©taires et quote-parts</h3>
            <div class="placeholder-content">
              <mat-icon>group</mat-icon>
              <p>Gestion des propri√©taires</p>
              <p>√Ä impl√©menter dans l'Interface 6</p>
            </div>
          </div>
        </div>
  
        <!-- Footer du formulaire -->
        <div class="form-footer">
          <div class="status-info">
            <span class="badge badge-draft">
              <mat-icon>edit</mat-icon>
              Brouillon
            </span>
            <span class="autosave-info">
              <mat-icon>cloud_done</mat-icon>
              Sauvegarde automatique activ√©e
            </span>
          </div>
          <div class="form-actions">
            <button mat-stroked-button type="button" routerLink="/parcelles/list">
              <mat-icon>cancel</mat-icon>
              Annuler
            </button>
            <button mat-stroked-button type="button" (click)="saveDraft()">
              <mat-icon>save</mat-icon>
              Enregistrer brouillon
          </button>
            <button mat-raised-button color="primary" type="button" (click)="nextTab()">
              <span *ngIf="activeTab !== 'proprietaires'">Suivant: {{ getNextTabLabel() }}</span>
              <span *ngIf="activeTab === 'proprietaires'">Finaliser cr√©ation</span>
              <mat-icon>arrow_forward</mat-icon>
          </button>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>