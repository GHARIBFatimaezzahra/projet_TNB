<!-- Interface Carte Interactive -->
<div class="interface-container">
  <div class="interface-header">
    <h2>Carte Interactive - Visualisation SIG</h2>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="goBack()">
        <i class="fas fa-arrow-left"></i> Retour
      </button>
      <button class="btn btn-primary" (click)="toggleSidePanel('layers-panel')">
        <i class="fas fa-layer-group"></i> Couches
      </button>
      <button class="btn btn-info" (click)="toggleSidePanel('tools-panel')">
        <i class="fas fa-tools"></i> Outils SIG
      </button>
    </div>
  </div>

  <!-- Stats rapides -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-icon" style="background: rgba(30, 64, 175, 0.1); color: var(--primary-color);">
          <i class="fas fa-map"></i>
        </div>
        <div class="stat-info">
          <h3>{{ mapStats.parcellesVisibles }}</h3>
          <p>Parcelles visibles</p>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            Actuellement chargées
          </div>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-icon" style="background: rgba(5, 150, 105, 0.1); color: var(--success-color);">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h3>{{ mapStats.parcellesPubliees }}</h3>
          <p>Parcelles publiées</p>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            {{ getPublishedPercentage() }}% du total
          </div>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-icon" style="background: rgba(217, 119, 6, 0.1); color: var(--warning-color);">
          <i class="fas fa-chart-area"></i>
        </div>
        <div class="stat-info">
          <h3>{{ mapStats.surfaceImposable }} Ha</h3>
          <p>Surface imposable</p>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            Total calculé
          </div>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-icon" style="background: rgba(14, 165, 233, 0.1); color: var(--info-color);">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="stat-info">
          <h3>{{ mapStats.tnbCalculee }} DH</h3>
          <p>TNB calculée</p>
          <div class="stat-trend positive">
            <i class="fas fa-arrow-up"></i>
            Montant total
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Carte principale -->
  <div class="map-interface">
    <div class="map-content" #mapContainer>
      <!-- La carte OpenLayers sera initialisée ici -->
    </div>
  </div>

  <!-- Panneau d'informations parcelle sélectionnée -->
  <div class="card selected-parcel-info" *ngIf="selectedParcel">
    <div class="card-header">
      <h3>Parcelle sélectionnée: {{ selectedParcel.reference }}</h3>
      <div class="header-actions">
        <button class="btn btn-primary btn-sm" (click)="viewParcelDetail()">
          <i class="fas fa-eye"></i> Détail complet
        </button>
        <button class="btn btn-secondary btn-sm" (click)="editParcel()">
          <i class="fas fa-edit"></i> Modifier
        </button>
      </div>
    </div>
    <div class="card-body">
      <div class="parcel-info-grid">
        <div class="info-item">
          <label>Propriétaire:</label>
          <span>{{ selectedParcel.proprietaire }}</span>
        </div>
        <div class="info-item">
          <label>Surface:</label>
          <span>{{ selectedParcel.surface }} m²</span>
        </div>
        <div class="info-item">
          <label>Zone:</label>
          <span class="zone-badge" [ngClass]="getZoneClass(selectedParcel.zone)">
            {{ selectedParcel.zone }}
          </span>
        </div>
        <div class="info-item">
          <label>TNB:</label>
          <span class="tnb-amount">{{ selectedParcel.tnb }} DH</span>
        </div>
      </div>
    </div>
  </div>

  <!-- État vide si aucune parcelle sélectionnée -->
  <div class="card selected-parcel-info" *ngIf="!selectedParcel">
    <div class="card-header">
      <h3>Aucune parcelle sélectionnée</h3>
      <div class="header-actions">
        <button class="btn btn-primary btn-sm" disabled>
          <i class="fas fa-eye"></i> Détail complet
        </button>
        <button class="btn btn-secondary btn-sm" disabled>
          <i class="fas fa-edit"></i> Modifier
        </button>
      </div>
    </div>
    <div class="card-body">
      <div class="empty-state">
        <i class="fas fa-mouse-pointer"></i>
        <p>Cliquez sur une parcelle de la carte pour voir ses informations</p>
      </div>
    </div>
  </div>
</div>

<!-- Panneau coulissant des couches -->
<div class="side-panel" [class.open]="layersPanelOpen" id="layers-panel">
  <div class="side-panel-header">
    <h3>Gestion des couches</h3>
    <button class="panel-close" (click)="toggleSidePanel('layers-panel')">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="side-panel-body">
    <h4>Couches de base</h4>
    <div class="layers-section">
      <label class="layer-item" *ngFor="let layer of baseLayers">
        <input type="radio" [name]="'base-layer'" [value]="layer.id" 
               [checked]="layer.active" (change)="toggleBaseLayer(layer.id)">
        <span class="layer-name">{{ layer.name }}</span>
      </label>
    </div>

    <h4>Couches thématiques</h4>
    <div class="layers-section">
      <label class="layer-item" *ngFor="let layer of thematicLayers">
        <input type="checkbox" [checked]="layer.visible" 
               (change)="toggleThematicLayer(layer.id)">
        <span class="layer-name">{{ layer.name }}</span>
        <span class="layer-count">{{ layer.count }}</span>
      </label>
    </div>
  </div>
</div>

<!-- Panneau coulissant des outils -->
<div class="side-panel" [class.open]="toolsPanelOpen" id="tools-panel">
  <div class="side-panel-header">
    <h3>Outils SIG avancés</h3>
    <button class="panel-close" (click)="toggleSidePanel('tools-panel')">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="side-panel-body">
    <h4>Outils de mesure</h4>
    <div class="tools-section">
      <button class="btn btn-secondary" (click)="activateMeasureTool('distance')">
        <i class="fas fa-ruler"></i> Mesurer une distance
      </button>
      <button class="btn btn-secondary" (click)="activateMeasureTool('area')">
        <i class="fas fa-vector-square"></i> Mesurer une surface
      </button>
    </div>

    <h4>Export et impression</h4>
    <div class="tools-section">
      <button class="btn btn-success" (click)="exportMapPNG()">
        <i class="fas fa-image"></i> Export PNG
      </button>
      <button class="btn btn-success" (click)="exportMapPDF()">
        <i class="fas fa-file-pdf"></i> Export PDF
      </button>
    </div>
  </div>
</div>
